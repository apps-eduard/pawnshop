<!-- Sidebar Overlay (Mobile) -->
<div
  *ngIf="isOpen"
  class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"
  (click)="onBackdropClick()">
</div>

<!-- Toast Notification -->
<div *ngIf="showToast"
     class="fixed bottom-6 right-6 z-[70] animate-slide-up">
  <div class="bg-green-600 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center space-x-3 min-w-[300px]">
    <div class="flex-shrink-0">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
    </div>
    <div class="flex-1">
      <p class="font-semibold">{{ toastMessage }}</p>
    </div>
    <button (click)="showToast = false" class="flex-shrink-0 text-white hover:text-gray-200">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>
</div>

<!-- Sidebar -->
<div
  class="fixed left-0 top-0 h-screen w-72 bg-white dark:bg-gray-900 shadow-xl transform transition-transform duration-300 z-50 sidebar flex flex-col"
  [class.translate-x-0]="isOpen"
  [class.-translate-x-full]="!isOpen"
  [class.lg:translate-x-0]="isOpen">

  <!-- Sidebar Header -->
  <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
    <div class="flex items-center space-x-3">
      <!-- Golden Diamond Icon -->
      <div class="h-8 w-8 flex items-center justify-center">
        <svg class="h-7 w-7 text-yellow-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M6,2l2,6h8l2,-6h-12Zm-2,8l5,12l5,-12h-10Zm14,0l-5,12l5,-12Z" opacity="0.8"/>
          <path d="M12,10l-5,12l10,0l-5,-12Z" fill="#fbbf24"/>
        </svg>
      </div>
      <div>
        <h2 class="text-lg font-bold text-gray-900 dark:text-white">
          <span class="text-yellow-600 dark:text-yellow-400">Gold</span>
          <span class="text-yellow-500 dark:text-yellow-300">Win</span>
        </h2>
        <p class="text-xs text-gray-500 dark:text-gray-400" *ngIf="currentUser">
          {{ currentUser.role | titlecase }}
        </p>
      </div>
    </div>

    <!-- Close Button (Always visible) -->
    <button
      (click)="closeSidebar.emit()"
      class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors"
      title="Close Sidebar">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>

  <!-- Navigation Content -->
  <div class="flex-1 overflow-y-auto sidebar-content min-h-0">

    <!-- User Info -->
    <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex-shrink-0" *ngIf="currentUser">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-primary-500 rounded-full flex items-center justify-center">
          <span class="text-sm font-medium text-white">
                              {{ currentUser.firstName.charAt(0) }}{{ currentUser.lastName.charAt(0) }}
          </span>
        </div>
        <div class="flex-1 min-w-0">
          <p class="text-sm font-medium text-gray-900 dark:text-white truncate">
            {{ currentUser.firstName }} {{ currentUser.lastName }}
          </p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">
            {{ currentUser.email }}
          </p>
        </div>
      </div>
    </div>

    <!-- Scrollable Navigation Area -->
    <div class="flex-1 overflow-y-auto">
      <!-- Navigation Items -->
      <nav class="p-4 space-y-2">
        <div class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-3">
          Navigation
        </div>

        <div *ngFor="let item of getFilteredNavigation()" class="group">
          <a
            [routerLink]="item.route"
            routerLinkActive="bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300 border-r-2 border-primary-500"
            class="flex items-center px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-l-md hover:bg-gray-50 dark:hover:bg-gray-800 hover:text-gray-900 dark:hover:text-white transition-all duration-200 group"
            (click)="navigateTo(item.route)">
            <span class="text-lg mr-3">{{ item.icon }}</span>
            {{ item.label }}
          </a>
        </div>
      </nav>

      <!-- Quick Actions -->
      <div class="p-4 border-t border-gray-200 dark:border-gray-700" *ngIf="getFilteredQuickActions().length > 0">
        <div class="text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-3">
          Quick Actions
        </div>

        <div class="space-y-2">
          <button
            *ngFor="let action of getFilteredQuickActions()"
            (click)="handleQuickAction(action.action)"
            class="w-full flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-md hover:bg-primary-50 dark:hover:bg-primary-900/20 hover:text-primary-700 dark:hover:text-primary-300 transition-all duration-200">
            <span class="text-lg mr-3">{{ action.icon }}</span>
            {{ action.label }}
          </button>
        </div>
      </div>
    </div>

    <!-- Footer with Current Time (Fixed at bottom) -->
    <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex-shrink-0">
      <div class="text-center">
        <div class="text-xs text-gray-500 dark:text-gray-400">
          {{ getCurrentDate() | date:'EEEE, MMM d, y' }}
        </div>
        <div class="text-sm font-medium text-gray-700 dark:text-gray-300">
          {{ getCurrentDate() | date:'h:mm a' }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Voucher Modal -->
<div
  *ngIf="showVoucherModal"
  class="fixed inset-0 bg-black bg-opacity-60 z-[60] flex items-center justify-center p-4"
  (click)="closeVoucherModal()">

  <div
    class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col"
    (click)="$event.stopPropagation()">

    <!-- Modal Header -->
    <div class="bg-gradient-to-r from-primary-600 to-primary-700 px-4 py-3 rounded-t-xl flex-shrink-0">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2zM10 8.5a.5.5 0 11-1 0 .5.5 0 011 0zm5 5a.5.5 0 11-1 0 .5.5 0 011 0z"></path>
            </svg>
          </div>
          <div>
            <h2 class="text-lg font-bold text-white">Create Voucher</h2>
            <p class="text-xs text-primary-100">Cash or Cheque Payment</p>
          </div>
        </div>
        <button
          (click)="closeVoucherModal()"
          class="p-1.5 text-white hover:bg-white hover:bg-opacity-20 rounded-lg transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Modal Body -->
    <div class="p-4 space-y-3 max-h-[calc(100vh-200px)] overflow-y-auto">

      <!-- First Row: Date and Payment Type -->
      <div class="flex items-center gap-3">
        <!-- Date Field with Icon -->
        <div class="relative w-48">
          <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
          </div>
          <input
            id="voucherDate"
            type="date"
            [(ngModel)]="voucherForm.date"
            name="voucherDate"
            tabindex="1"
            class="w-full pl-9 pr-3 py-2 text-sm border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
            required>
        </div>

        <!-- Payment Type Selection -->
        <div class="flex gap-2 flex-1">
          <!-- Cash Option -->
          <label class="relative cursor-pointer flex-1">
            <input
              type="radio"
              [(ngModel)]="voucherForm.type"
              name="type"
              value="cash"
              tabindex="7"
              title="Cash Payment"
              class="peer sr-only">
            <div class="p-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg hover:border-primary-500 peer-checked:border-green-500 peer-checked:bg-green-50 dark:peer-checked:bg-green-900/20 transition-all h-full">
              <div class="flex flex-col items-center justify-center space-y-1">
                <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
                <span class="text-xs font-bold text-gray-900 dark:text-white">Cash</span>
              </div>
            </div>
          </label>

          <!-- Cheque Option -->
          <label class="relative cursor-pointer flex-1">
            <input
              type="radio"
              [(ngModel)]="voucherForm.type"
              name="type"
              value="cheque"
              tabindex="8"
              title="Cheque Payment"
              class="peer sr-only">
            <div class="p-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg hover:border-primary-500 peer-checked:border-blue-500 peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/20 transition-all h-full">
              <div class="flex flex-col items-center justify-center space-y-1">
                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span class="text-xs font-bold text-gray-900 dark:text-white">Cheque</span>
              </div>
            </div>
          </label>
        </div>
      </div>

      <!-- Second Row: Amount, Notes, and Add Button -->
      <div class="flex items-center gap-2">
        <!-- Amount with Icon -->
        <div class="relative w-48">
          <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <input
            id="voucherAmount"
            type="text"
            [(ngModel)]="voucherForm.amount"
            name="amount"
            appCurrencyInput
            placeholder="Amount"
            tabindex="2"
            class="w-full pl-9 pr-3 py-2 text-sm border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
            required>
        </div>

        <!-- Notes with Icon -->
        <div class="relative flex-1">
          <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
          </div>
          <input
            id="voucherNotes"
            type="text"
            [(ngModel)]="voucherForm.notes"
            name="notes"
            placeholder="Enter notes..."
            tabindex="3"
            class="w-full pl-9 pr-3 py-2 text-sm border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
            required>
        </div>

        <!-- Add Button (Icon Only) -->
        <button
          type="button"
          (click)="addVoucher()"
          tabindex="4"
          title="Add Voucher"
          class="p-2.5 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors shadow-sm flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </button>
      </div>

      <!-- Added Vouchers List -->
      <div *ngIf="voucherList.length > 0" class="border-t-2 border-gray-200 dark:border-gray-700 pt-3 space-y-3">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-bold text-gray-700 dark:text-gray-300">
            Added Vouchers ({{ voucherList.length }})
          </h3>
          <span class="text-base font-bold text-primary-600 dark:text-primary-400">
            Total: ₱{{ getTotalAmount().toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) }}
          </span>
        </div>
        <div class="max-h-48 overflow-y-auto space-y-2">
          <div *ngFor="let voucher of voucherList"
               class="flex items-start justify-between p-2.5 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600 hover:border-primary-400 transition-colors">
            <div class="flex-1 min-w-0 space-y-1">
              <div class="flex items-center gap-2 flex-wrap">
                <span class="px-2 py-0.5 text-xs font-bold rounded-md"
                      [ngClass]="{
                        'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400': voucher.type === 'cash',
                        'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400': voucher.type === 'cheque'
                      }">
                  {{ voucher.type.toUpperCase() }}
                </span>
                <span class="text-xs text-gray-600 dark:text-gray-400 font-medium">
                  {{ voucher.date }}
                </span>
                <span class="text-sm font-bold text-gray-900 dark:text-white">
                  ₱{{ voucher.amount.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) }}
                </span>
              </div>
              <p class="text-xs text-gray-600 dark:text-gray-400 truncate">{{ voucher.notes }}</p>
            </div>
            <button (click)="removeVoucher(voucher.id)"
                    type="button"
                    class="ml-2 flex-shrink-0 p-1 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors"
                    title="Remove voucher">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

      <!-- Modal Footer -->
      <div class="flex items-center justify-end gap-3 px-4 py-3 border-t-2 border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">
        <button
          type="button"
          (click)="closeVoucherModal()"
          tabindex="6"
          class="px-5 py-2 text-sm font-medium border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
          Close
        </button>
        <button
          *ngIf="voucherList.length > 0"
          type="button"
          (click)="saveAllVouchers()"
          tabindex="5"
          class="px-5 py-2 text-sm font-medium bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-sm flex items-center space-x-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
          </svg>
          <span>Save All ({{ voucherList.length }})</span>
        </button>
      </div>
  </div>
</div>
