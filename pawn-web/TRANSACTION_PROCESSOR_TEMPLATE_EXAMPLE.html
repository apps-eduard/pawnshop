<!-- Transaction Processor Component Template Example -->
<div class="transaction-processor-container p-6 max-w-4xl mx-auto">

  <!-- Header -->
  <div class="mb-6">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Transaction Processor</h2>
    <p class="text-gray-600 dark:text-gray-400">Process loan transactions with penalty calculations</p>
  </div>

  <!-- Loan Information Section -->
  <div *ngIf="currentLoan" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
    <h3 class="text-lg font-semibold mb-4">Loan Information</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Loan ID</label>
        <p class="text-sm text-gray-900 dark:text-white">{{ currentLoan.id }}</p>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Transaction Number</label>
        <p class="text-sm text-gray-900 dark:text-white">{{ currentLoan.transactionNumber }}</p>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Principal Amount</label>
        <p class="text-sm text-gray-900 dark:text-white">₱{{ currentLoan.principalLoan | number:'1.2-2' }}</p>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Interest Rate</label>
        <p class="text-sm text-gray-900 dark:text-white">{{ currentLoan.interestRate }}%</p>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Maturity Date</label>
        <p class="text-sm text-gray-900 dark:text-white">{{ currentLoan.maturedDate | date:'mediumDate' }}</p>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Status</label>
        <span class="inline-flex px-2 py-1 text-xs font-medium rounded-full"
              [ngClass]="{
                'bg-green-100 text-green-800': currentLoan.status === 'ACTIVE',
                'bg-yellow-100 text-yellow-800': currentLoan.status === 'RENEWED',
                'bg-red-100 text-red-800': currentLoan.status === 'EXPIRED'
              }">
          {{ currentLoan.status }}
        </span>
      </div>
    </div>

    <!-- Overdue Warning -->
    <div *ngIf="isLoanOverdue()" class="mt-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
      <div class="flex items-center">
        <svg class="w-5 h-5 text-red-600 dark:text-red-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
        </svg>
        <span class="text-red-800 dark:text-red-200 font-medium">
          Loan is overdue by {{ Math.abs(getDaysUntilMaturity()) }} days
        </span>
      </div>
    </div>
  </div>

  <!-- Penalty Calculation Display -->
  <div *ngIf="showCalculations && penaltyDetails" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
    <h3 class="text-lg font-semibold mb-4">Penalty Calculation</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Days Overdue</label>
        <p class="text-sm text-gray-900 dark:text-white">{{ penaltyDetails.daysOverdue }} days</p>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Penalty Amount</label>
        <p class="text-sm text-gray-900 dark:text-white font-semibold">₱{{ penaltyDetails.penaltyAmount | number:'1.2-2' }}</p>
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Calculation Details</label>
        <p class="text-sm text-gray-600 dark:text-gray-400">{{ getPenaltyDisplayText() }}</p>
      </div>
    </div>
  </div>

  <!-- Redemption Calculation Display -->
  <div *ngIf="showCalculations && redemptionCalculation" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
    <h3 class="text-lg font-semibold mb-4">Total Amount Due</h3>

    <div class="space-y-3">
      <div class="flex justify-between">
        <span class="text-gray-700 dark:text-gray-300">Principal Amount:</span>
        <span class="text-gray-900 dark:text-white">₱{{ redemptionCalculation.principalAmount | number:'1.2-2' }}</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-700 dark:text-gray-300">Interest:</span>
        <span class="text-gray-900 dark:text-white">₱{{ redemptionCalculation.interestAmount | number:'1.2-2' }}</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-700 dark:text-gray-300">Penalty:</span>
        <span class="text-gray-900 dark:text-white">₱{{ redemptionCalculation.penaltyAmount | number:'1.2-2' }}</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-700 dark:text-gray-300">Service Charges:</span>
        <span class="text-gray-900 dark:text-white">₱{{ redemptionCalculation.serviceCharges | number:'1.2-2' }}</span>
      </div>
      <hr class="border-gray-200 dark:border-gray-600">
      <div class="flex justify-between font-semibold text-lg">
        <span class="text-gray-900 dark:text-white">Total Amount Due:</span>
        <span class="text-primary-600 dark:text-primary-400">₱{{ redemptionCalculation.totalAmountDue | number:'1.2-2' }}</span>
      </div>
    </div>
  </div>

  <!-- Transaction Type Selection -->
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
    <h3 class="text-lg font-semibold mb-4">Select Transaction Type</h3>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
      <button (click)="selectTransactionType('REDEEM')"
              [class]="selectedTransactionType === 'REDEEM' ? 'bg-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
              class="px-4 py-3 rounded-lg font-medium transition-colors hover:bg-primary-500 hover:text-white">
        Redeem
      </button>
      <button (click)="selectTransactionType('RENEW')"
              [class]="selectedTransactionType === 'RENEW' ? 'bg-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
              class="px-4 py-3 rounded-lg font-medium transition-colors hover:bg-primary-500 hover:text-white">
        Renew
      </button>
      <button (click)="selectTransactionType('ADDITIONAL')"
              [class]="selectedTransactionType === 'ADDITIONAL' ? 'bg-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
              class="px-4 py-3 rounded-lg font-medium transition-colors hover:bg-primary-500 hover:text-white">
        Additional
      </button>
      <button (click)="selectTransactionType('PARTIAL')"
              [class]="selectedTransactionType === 'PARTIAL' ? 'bg-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
              class="px-4 py-3 rounded-lg font-medium transition-colors hover:bg-primary-500 hover:text-white">
        Partial
      </button>
    </div>
  </div>

  <!-- Transaction Forms -->
  <div *ngIf="selectedTransactionType" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">

    <!-- REDEEM Form -->
    <div *ngIf="selectedTransactionType === 'REDEEM'">
      <h3 class="text-lg font-semibold mb-4">Redeem Loan</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Payment Amount</label>
          <input type="number" [(ngModel)]="redeemForm.paymentAmount"
                 class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Payment Method</label>
          <select [(ngModel)]="redeemForm.paymentMethod"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
            <option value="CASH">Cash</option>
            <option value="CHEQUE">Cheque</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Remarks</label>
          <textarea [(ngModel)]="redeemForm.remarks" rows="3"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"></textarea>
        </div>
      </div>
      <div class="mt-6">
        <button (click)="processRedeem()" [disabled]="!canProcessRedeem() || isProcessing"
                class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed">
          <span *ngIf="isProcessing">Processing...</span>
          <span *ngIf="!isProcessing">Process Redemption</span>
        </button>
      </div>
    </div>

    <!-- PARTIAL Payment Form -->
    <div *ngIf="selectedTransactionType === 'PARTIAL'">
      <h3 class="text-lg font-semibold mb-4">Partial Payment</h3>

      <!-- Payment Application Preview -->
      <div *ngIf="calculatePartialPaymentPreview() as preview" class="mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
        <h4 class="font-medium text-blue-900 dark:text-blue-100 mb-2">Payment Distribution Preview</h4>
        <div class="text-sm space-y-1">
          <div class="flex justify-between">
            <span>Service Charges:</span>
            <span>₱{{ preview.appliedToServiceCharges | number:'1.2-2' }}</span>
          </div>
          <div class="flex justify-between">
            <span>Penalty:</span>
            <span>₱{{ preview.appliedToPenalty | number:'1.2-2' }}</span>
          </div>
          <div class="flex justify-between">
            <span>Interest:</span>
            <span>₱{{ preview.appliedToInterest | number:'1.2-2' }}</span>
          </div>
          <div class="flex justify-between">
            <span>Principal:</span>
            <span>₱{{ preview.appliedToPrincipal | number:'1.2-2' }}</span>
          </div>
          <hr class="border-blue-200 dark:border-blue-700">
          <div class="flex justify-between font-medium">
            <span>Remaining Balance:</span>
            <span>₱{{ preview.remainingBalance | number:'1.2-2' }}</span>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Payment Amount</label>
          <input type="number" [(ngModel)]="partialForm.paymentAmount"
                 class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Payment Method</label>
          <select [(ngModel)]="partialForm.paymentMethod"
                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
            <option value="CASH">Cash</option>
            <option value="CHEQUE">Cheque</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Remarks</label>
          <textarea [(ngModel)]="partialForm.remarks" rows="3"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"></textarea>
        </div>
      </div>
      <div class="mt-6">
        <button (click)="processPartialPayment()" [disabled]="!canProcessPartial() || isProcessing"
                class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed">
          <span *ngIf="isProcessing">Processing...</span>
          <span *ngIf="!isProcessing">Process Partial Payment</span>
        </button>
      </div>
    </div>

    <!-- Similar forms for RENEW and ADDITIONAL would go here -->

  </div>

  <!-- Loading State -->
  <div *ngIf="isProcessing" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 flex items-center space-x-3">
      <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"></div>
      <span class="text-gray-900 dark:text-white">Processing transaction...</span>
    </div>
  </div>

</div>
